<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LocoTranz | Login</title>
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />
    <link rel="stylesheet" href="../styles/login.css" />
    <link rel="stylesheet" href="../css/toast.css" />
  </head>
 
  <body>
    <!-- ðŸŽ¥ BACKGROUND VIDEO -->
    <video autoplay loop muted playsinline class="bg-video">
      <source src="../assests/background video.mp4" type="video/mp4" />
    </video>

    <!-- HEADER -->
    <header>
      <div class="logo">
        <div class="logo-icon"></div>
        <span>LocoTranz</span>
      </div>
  
    </header>

    <!-- LOGIN FORM -->
    <div class="login-container" data-aos="zoom-in">
      <div class="bus-icon">
        <img
          src="https://cdn-icons-png.flaticon.com/128/4709/4709348.png"
          alt="Bus Icon"
        />
      </div>
      <h1>Welcome Back Admin!</h1>
      <p class="subtitle">Login to your account</p>

      <form>
        <div class="form-group">
          <label for="email">Email Address</label>
          <input
            type="email"
            id="email"
            placeholder="Enter your email"
            required
          />
        </div>
        <div class="form-group">
          <label for="password">Password</label>
          <input
            type="password"
            id="password"
            placeholder="Enter your password"
            required
          />
          <p style="color: rgb(197, 194, 194);font-size: 12px;margin-top: 10px;margin-left: 70px;">Email : admin@locotranz.com</p>
          <p style="color: rgb(197, 194, 194);font-size: 12px;margin-left: 70px">Password : admin</p>
        </div>
 
        <button
          type="submit"
          class="login-btn"
         
        >
          Login
        </button>

         
      </form>
 

 

      
      <footer id="contact">
        <p>&copy; 2025 LocoTranz. Luxury in Motion | support@locotranz.com</p>
      </footer>
  
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
      AOS.init({ duration: 1000 });
    </script>
    <script src="../js/config.js"></script>
    <script src="../js/toast.js"></script>
    <script>
      const form = document.querySelector('form');
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        
        // Show loading state on button
        const loginBtn = document.querySelector('.login-btn');
        const originalText = loginBtn.textContent;
        loginBtn.textContent = 'Authenticating...';
        loginBtn.disabled = true;

        try {
          // 1. Attempt real backend login to get a valid token
          const response = await fetch(`${API_BASE_URL}/users/login`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              name: "admin", 
              email: email,
              password: password,
              full_name: "Admin",
              role: "admin"
            })
          });

          if (response.ok) {
            const user = await response.json();
            // Optional: Force role check if your backend doesn't handle it
            // if (user.role !== 'admin') { throw new Error('Not an admin'); }
            
            localStorage.setItem('user', JSON.stringify(user));
            showToast('Welcome back, Admin!', 'success');
            setTimeout(() => {
              window.location.href = 'admin.html';
            }, 1000);
          } else {
            // 2. Fallback to hardcoded credentials for demo/backdoor purposes
            if (email === 'admin@locotranz.com' && password === 'admin') {
              showToast('Admin logged in (Offline Mode - Backend failed)', 'success');
              const dummyAdmin = {
                full_name: "Administrator",
                email: email,
                access_token: "dummy_token",
                role: "admin"
              };
              localStorage.setItem('user', JSON.stringify(dummyAdmin));
              setTimeout(() => {
                window.location.href = 'admin.html';
              }, 1000);
            } else {
              showToast('Invalid admin credentials', 'error');
            }
          }
        } catch (err) {
          console.error(err);
          // 3. Fallback on network error
          if (email === 'admin@locotranz.com' && password === 'admin') {
            const dummyAdmin = {
              full_name: "Administrator",
              email: email,
              access_token: "dummy_token",
              role: "admin"
            };
            localStorage.setItem('user', JSON.stringify(dummyAdmin));
            showToast('Admin logged in (Network Offline)', 'success');
            setTimeout(() => { window.location.href = 'admin.html'; }, 1000);
          } else {
            showToast('Login failed. Please check backend connection.', 'error');
          }
        } finally {
          loginBtn.textContent = originalText;
          loginBtn.disabled = false;
        }
      });
    </script>
  </body>
</html>
