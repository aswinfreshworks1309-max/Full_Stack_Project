<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LocoTranz | Login</title>
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />
    <link rel="stylesheet" href="../styles/login.css" />
    <link rel="stylesheet" href="../css/toast.css" />
    <script src="../js/auth_check.js"></script>
  </head>
 
  <body>
    <!-- ðŸŽ¥ BACKGROUND VIDEO -->
    <video autoplay loop muted playsinline class="bg-video">
      <source src="../assests/background video.mp4" type="video/mp4" />
    </video>

    <!-- HEADER -->
    <header>
      <div class="logo">
        <div class="logo-icon"></div>
        <span>LocoTranz</span>
      </div>
  
    </header>

    <!-- LOGIN FORM -->
    <div class="login-container" data-aos="zoom-in">
      <div class="bus-icon">
        <img
          src="https://cdn-icons-png.flaticon.com/128/4709/4709348.png"
          alt="Bus Icon"
        />
      </div>
      <h1>Welcome Back Admin!</h1>
      <p class="subtitle">Login to your account</p>

      <form>
        <div class="form-group">
          <label for="email">Email Address</label>
          <input
            type="email"
            id="email"
            placeholder="Enter your email"
            required
          />
        </div>
        <div class="form-group">
          <label for="password">Password</label>
          <input
            type="password"
            id="password"
            placeholder="Enter your password"
            required
          />
          <p style="color: rgb(197, 194, 194);font-size: 12px;margin-top: 10px;margin-left: 70px;">Email : admin@locotranz.com</p>
          <p style="color: rgb(197, 194, 194);font-size: 12px;margin-left: 70px">Password : admin</p>
        </div>
 
        <button
          type="submit"
          class="login-btn"
         
        >
          Login
        </button>

         
      </form>
 

 

      
      <footer id="contact">
        <p>&copy; 2025 LocoTranz. Luxury in Motion | support@locotranz.com</p>
      </footer>
  
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
      AOS.init({ duration: 1000 });
    </script>
    <script src="../js/config.js"></script>
    <script src="../js/toast.js"></script>
    <script>
      const form = document.querySelector('form');
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        
        // Show loading state on button
        const loginBtn = document.querySelector('.login-btn');
        const originalText = loginBtn.textContent;
        loginBtn.textContent = 'Authenticating...';
        loginBtn.disabled = true;

        try {
          const response = await fetch(`${API_BASE_URL}/users/login`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              name: "admin", // Dummy for schema
              email: email,
              password: password,
              full_name: "admin", // Dummy for schema
              role: "admin" // Requesting admin role
            })
          });

          if (response.ok) {
            const user = await response.json();
            if (user.role !== 'admin') {
              showToast('Access denied: User is not an admin', 'error');
              return;
            }
            showToast('Admin logged in successfully', 'success');
            localStorage.setItem('user', JSON.stringify(user));
            setTimeout(() => {
              window.location.href = './admin.html';
            }, 1000);
          } else {
            const errData = await response.json();
            showToast(errData.detail || 'Invalid admin credentials', 'error');
          }
        } catch (err) {
          console.error(err);
          showToast('An unexpected error occurred', 'error');
        } finally {
          loginBtn.textContent = originalText;
          loginBtn.disabled = false;
        }
      });
    </script>
  </body>
</html>
